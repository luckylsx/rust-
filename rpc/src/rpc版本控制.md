## grpc版本控制

grpc服务更改时，应考虑一下内容：

* 更改会对客户端造成如何影响
* 应实现支持更改对版本控制策略

### 向后兼容性

grpc协议旨在支持随时间变化的服务。通常grpc服务和方法会不中断的新增内容。非中断性变更允许现有客户端继续工作而不做任何更改。更改或删除grpc服务是中断性变更。grpc服务发生中断性变更时，必须更新和重新部署使用该服务的客户端。

对服务进行非中断性变更有一下好处：

* 现有客户端继续运行
* 避免向客户端通知中断性变更并进行更新
* 只需要记录和维护服务对一个版本

### 非重大变化

在grpc协议级别和二进制级别，这些变更不会中断。

* 添加新服务
* 向新服务添加新方法
* 将字段添加到请求消息 - 添加到请求消息的字段将在服务器上通过默认值（若未设置）进行反序列化。若要实现非中断性变更，当新字段不是由旧客户端设置时，服务必须成功。
* 将字段添加到响应消息 - 添加到响应消息的字段将反序列化到客户端上消息的未知字段集合中
* 向枚举添加新值 - 枚举被序列化为数值。新的枚举在客户端反序列化为没有枚举名的枚举值。若要实现非中断性变更，旧客户端在接收新枚举值时必须正确运行。

### 二进制中断性变更

以下变更在grpc协议级别是非中断性变更，但如果客户端升级到最新到.proto协议或客户端程序集，则需要对其进行更新。如果你计划将grpc库发布到NuGet，二进制兼容性很重要。

* 删除字段 - 已删除字段中的值被反序列化为消息的未知类型，这并不是grpc协议中断性变更，但如果客户端升级到最新的协定，则需要对其更新。删除的字段编号不会在将来被意外重用，这点很重要。若要确保不会发生这种情况，请使用protobuf的保留关键字指定已删除的字段名称或者编号。
* 重命名消息 - 消息名称通常不会在网络上发送，因此这不是grpc协议中断性变更。如果客户端升级到最新的协定，则需要对其进行更新。当消息名称用于标识消息类型时，任何字段都会出现消息名称在网络上发送的情况。
* 嵌套或取消嵌套 - 消息类型可以嵌套。嵌套或取消嵌套消息将更改其消息名称。更改消息类型的嵌套方式对兼容性的影响与重命名相同。
* 更改csharp_namespace - 更改csharp_namespace将更改所生成的pb代码类型的命名空间。这并不是grpc协议中断性变更，但如果客户端升级到最新的协定，则需要对其进行更新。

### 协议中断性变更

以下各项是协议和二进制的中断性变更。
