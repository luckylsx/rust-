## 所有权

所有权是Rust 里最独特的特性,它让Rust无需GC 就可以保证内存安全。

### 什么是所有权
* Rust 的核心特性就是所有权
* 所有程序在运行时必须管理他们使用计算机内存的方式
    * 有些语言有垃圾收集机制，在程序运行时，他们会不断地寻找不再使用的内存，将他们收集和释放。
    * 在其他语言中，程序员必须显式地分配和释放内存。
* Rust 采用了另一种方式 - 所有权
    * 内存是通过所有权来系统来管理的，其中包含一组编译器在编译时检查的规则。
    * 当程序运行时，所有权特性不会减慢程序的运行速度

### Stack(栈内存) vs Heap(堆内存)

* 在像Rust这样的系统级编程语言里，一个值在stack 上还是 Heap 上对语言的行为和你为什么要做某些决定是有很大的影响的
* stack 按值的接收顺序来存储，按相反的顺序将他们移除（先进后出 LIFO）
    * 添加数据叫压入栈
    * 移除数据叫做弹出栈
* 所有存储在 Stack 上的数据必须拥有已知的规定的大小
    * 编译时大小未知的数据或运行时大小可能会发生变化的数据必须存放在heap 上
* Heap 对内存组织性差一点。
    * 当你把数据放入heap 时，你会请求一定量对数据空间
    * 操作系统会在heap 里找到一块儿足够大对空间，把他们标记为在用，并返回一个指针，也就是这个空间的地址。
    * 这个过程就叫做在heap 上进行内存分配，有时仅仅成为“分配”

### 存储数据
* 把值压到stack 上不叫分配
* 因为指针是已知固定大小的，可以把指针放在stack 上。
    *  但如果想要实际数据，你必须使用指针来定位。(想象成和朋友去饭店吃饭，到饭店之后，会和饭店人员标明自己有多少人需要多少个位置，这是服务员会找到足够大的空桌子，然后带你们过去就餐，这时，就算有的人来晚了，也可以通过桌号来找到你们。)
* 把数据压到 stack 上要比在heap 上分配快的多
    * 因为操作系统不需要寻找用来存储数据的空间，那个位置永远都在stack 的顶端。
* 在 heap 上分配空间需要做更多的工作
    * 操作系统首先需要找到 一个足够大的内存空间来存放数据，然后做好记录方便下次分配

### 访问数据
* 访问heap 中的数据要比访问stack 中的数据慢，因为需要通过指针才能找到heap 中的数据。
    * 对于现代的处理器来说，由于缓存的缘故，如果指令在内存中跳转的次数越少，那么速度就越快。
* 如果数据存放的距离比较近，那么处理器的处理速度就会更快一些（stack上）
* 如果数据之间的距离比较远，那么处理速度就会慢一些（heap）
* 在heap 上分配大量的空间也是需要时间的。

### 函数调用
* 当你的代码调用函数时，值被传入到函数（也包括指向heap的指针）。函数本地的变量被压到stack 上。当函数结束后，这些值会从stack 上弹出。

### 所有权存在的原因。
* 所有权解决的问题：
    * 跟踪代码的哪些部分正在使用heap 的哪些数据
    * 最小化heap 上的重复数据量
    * 清理heap 上未使用的数据以避免空间不足
* 一旦了解所有权，就不需要经常去想stack 或者 heap 了。
* 但是需要知道管理heap 数据才是 所有权存在的原因，这有助于解释它为什么会这样工作。
